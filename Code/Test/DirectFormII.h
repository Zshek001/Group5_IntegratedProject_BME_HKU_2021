
//filter sample01:Bandpass, Chebyshv II, MinOrder(26, section 13), Match Stopband,
//Hz, Fs50, 0.5, 0.66, 8, 12, 
//dB, 60, 1, 80

const int numStage = 13;
float Coeffs_sample01[numStage * 5] = 
{
1,  -1.996106048410463351672206044895574450493,   1,    -0.953038797436169149435158942651469260454,  0.88951701622260170854161742681753821671,
1,  -0.607585479972089892441999836592003703117,   1,    -1.983035821437771240027814201312139630318,  0.989309783362369521420021101221209391952,
1,  -1.996512834973201533372844096447806805372,   1,    -0.821569753291357507407610683003440499306,  0.691414523826323734745358251529978588223,
1,  -0.505735519260496202420540612365584820509,   1,    -1.962284641863488943158699839841574430466,  0.968193137133703474184187598439166322351,
1,  -1.997252134432572212574541481444612145424,   1,    -1.942143793607569612902352673700079321861,  0.947445567949532274631962991406908258796,
1,  -0.276712392731898459974360093838186003268,   1,    -0.674233199860213572307543472561519593   ,  0.506828634663675448024378056288696825504,
1,  -1.998177986015588158963396381295751780272,   1,    -1.922989148834448602798374849953688681126,  0.927546550595506613667851070204051211476,
1,   0.132420956608992362868448822155187372118,   1,    -0.517681159762837905802257409959565848112,  0.329959529815342933467547936743358150125,
1,  -1.999086646198828365328381551080383360386,   1,    -1.906058267410661866136933895177207887173,  0.909881544787440876831396963098086416721,
1,   0.77984447016315450174062107180361635983 ,   1,    -0.370497944605992945987793518725084140897,  0.17111404969930016362056335310626309365,
1,  -1.999754154672984896023990586400032043457,   1,    -1.893775738603643787882901960983872413635,  0.897050902152532025901621182129019871354,
1,   1.577414675012146938470891655015293508768,   1,    -0.261989448254461798626380186760798096657,  0.055403092225131220227574146974802715704,
1,   0                                        ,  -1,    -1.055383004818446046613189537310972809792,  0.104655349465019156807166211820003809407
};

float p_bx_Gain_sample01[numStage] = 
{
0.795583608836923139584484943043207749724,
0.795583608836923139584484943043207749724,
0.739707446968585702329335163085488602519,
0.739707446968585702329335163085488602519,
0.676649493843606286702652141684666275978,
0.676649493843606286702652141684666275978,
0.605860250279752321489468158688396215439,
0.605860250279752321489468158688396215439,
0.532669526815833349608908520167460665107,
0.532669526815833349608908520167460665107,
0.47218929343133497766871187195647507906,
0.47218929343133497766871187195647507906,
0.447672325267490400779735182368312962353
};



float Wn_store[numStage * 2]; // Wn of all stages are stored here. global.

float DirectFormIISOS(
  float input,     //real time single feed input
  float *pCoeffs,
  float *p_bx_Gain
);

float DirectFormIISOS(
  float input,     //real time single feed input
  float *pCoeffs,
  float *p_bx_Gain
)
{
  int stage;
  float Xn, Yn;                //input & output for stages
  float a1, a2, g, b0, b1, b2; //coefficients for stages
  float Wn1 = 0, Wn2 = 0;      //middle variable w(n-1), w(n-2)
  float Wn0;                   //middle variable w(n)

  stage = 0;

  Yn = input;

  do {

    b0 = *pCoeffs++;
    b1 = *pCoeffs++;
    b2 = *pCoeffs++;
    a1 = *pCoeffs++;
    a2 = *pCoeffs++;
    g = *p_bx_Gain++;


    Wn1 = Wn_store[stage * 2];
    Wn2 = Wn_store[stage * 2 + 1];
    Xn = Yn;

    Wn0 = - a1 * Wn1 - a2 * Wn2 + Xn;
    Yn = g * (b0 * Wn0 + b1 * Wn1 + b2 * Wn2);

    Wn_store[stage * 2] = Wn0;
    Wn_store[stage * 2 + 1] = Wn1;

    stage++;

  } while(stage < numStage);

  return Yn;
}
