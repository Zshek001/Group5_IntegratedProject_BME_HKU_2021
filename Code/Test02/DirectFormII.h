
//filter sample01:Bandpass, Chebyshv II, MinOrder(26, section 13), Match Stopband,
//Hz, Fs50, 0.5, 0.66, 8, 12, 
//dB, 60, 1, 80

const int numStage = 13;
float Coeffs_sample01[numStage * 5] = 
{
1 , -1.996104325294067560747635070583783090115,   1,    -1.345246398138083998574643374013248831034,  0.912469165811669258303595597681123763323,
1 , -1.132728542518984360398803801217582076788,   1,    -1.983766948860636425422399042872712016106,  0.989926257963308242615596554969670251012,
1 , -1.996499242874022028715330634440761059523,   1,    -1.210293472297389261171929319971241056919,  0.748670604017511287509023532038554549217,
1 , -1.057863207066962241142960010620299726725,   1,    -1.963995917804071567047685675788670778275,  0.969830993478680736252783844975056126714,
1 , -1.997223752168986843358311489282641559839,   1,    -1.060554131270325495250972380745224654675,  0.585657209328214634069809108041226863861,
1 , -0.880644476806071829777522452786797657609,   1,    -1.944229653915320765733554253529291599989,  0.949525395038835706706947803468210622668,
1 , -1.998143965068601701773332024458795785904,   1,    -1.924494110176494743313924118410795927048,  0.929123736502527219904834510089131072164,
1 , -0.529456972536233361203983349696500226855,   1,    -0.897578868749243197200371469079982489347,  0.417699494535456072874524124927120283246,
1 , -1.99906180887489881570218130946159362793 ,   1,    -1.905837501167855663197769899852573871613,  0.909804780772773158403765592083800584078,
1 ,  0.139871971950520007643703479516261722893,   1,    -0.738013715970078032491130670678103342652,  0.255457170976970404652206525497604161501,
1 , -1.999745875356519597687565692467615008354,   1,    -1.891216911558649460545211695716716349125,  0.894686099182657290640463543240912258625,
1 ,  1.237775423288660636700342365656979382038,   1,    -0.615614963512764346020844641316216439009,  0.129630709109573333259746164003445301205,
1 ,  0                                        ,  -1,    -1.22718354683301122953764661360764876008 ,  0.268177756189368288186614108781213872135
};

float p_bx_Gain_sample01[numStage] = 
{
0.777176303640147669860027690447168424726,                                                                                                  
0.777176303640147669860027690447168424726,                                                                                                  
0.726907632288407490328552285063778981566,                                                                                                  
0.726907632288407490328552285063778981566,                                                                                                  
0.662956859788215835393998531799297779799,                                                                                                  
0.662956859788215835393998531799297779799,                                                                                                  
0.58299757510106342550670888158492743969 ,                                                                                                  
0.58299757510106342550670888158492743969 ,                                                                                                  
0.490564204592602914889454268632107414305,                                                                                                  
0.490564204592602914889454268632107414305,                                                                                                  
0.40440897155974286913959758749115280807 ,                                                                                                  
0.40440897155974286913959758749115280807 ,                                                                                                  
0.365911121905315883662268561238306574523       
};



float Wn_store[numStage * 2]; // Wn of all stages are stored here. global.


float DirectFormIISOS(
  float input,     //real time single feed input
  float *pCoeffs,
  float *p_bx_Gain
);

float DirectFormIISOS(
  float input,     //real time single feed input
  float *pCoeffs,
  float *p_bx_Gain
)
{
  int stage;
  float Xn, Yn;                //input & output for stages
  float a1, a2, g, b0, b1, b2; //coefficients for stages
  float Wn1 = 0, Wn2 = 0;      //middle variable w(n-1), w(n-2)
  float Wn0;                   //middle variable w(n)

  stage = 0;

  Yn = input;

  do {

    b0 = *pCoeffs++;
    b1 = *pCoeffs++;
    b2 = *pCoeffs++;
    a1 = *pCoeffs++;
    a2 = *pCoeffs++;
    g = *p_bx_Gain++;


    Wn1 = Wn_store[stage * 2];
    Wn2 = Wn_store[stage * 2 + 1];
    Xn = Yn;

    Wn0 = - a1 * Wn1 - a2 * Wn2 + Xn;
    Yn = g * (b0 * Wn0 + b1 * Wn1 + b2 * Wn2);

    Wn_store[stage * 2] = Wn0;
    Wn_store[stage * 2 + 1] = Wn1;

    stage++;

  } while(stage < numStage);

  return -1 * Yn;
}
