/*
 * This file includes the external constant and variable used in all of the other files.
*/
#define constant 1

#define PEAK 10;
#define TROUGH 11;

//constant declaration//
const int loop_frequency = 200;                     //loop frequency in Hz//
const int loop_period = 1000000 / loop_frequency;  //loop period in us//
const int PDdelay = loop_period / 2;                    //delay time for PD response in us//
const int erase_period = 10000000;          //Clear the buffer and calculate for every 10 seconds//


const int analog_MAX = 4095;                //Maximum of the analog reading/writing//
const double Vmax = 3.3;                    //Maximum of the output voltage//

// Pin declaration //
//const int RED = DAC0;  //Red LED//
//const int NIR = DAC1;  //NIR LED//
const int RED = A2;  //Red LED//
const int NIR = A1;  //NIR LED//

//const int RED = 5;
//const int NIR = 6;

const int PD = A0;  //photodetector//



//Variable declaration//
int i = 0;           //loop times//
int loop_start = 0;  //starting time of this loop//
int loop_end = 0;    //ending time of this loop//
int detected_RED = 0;//reading of PD for RED signal//
int detected_NIR = 0;//reading of PD for NIR signal//
int filtered_RED = 0;//filtered data of RED signal//
int filtered_NIR = 0;//filtered data of NIR signal//
double Vout = 3.3;//Output woltage of LED light//
//int LED[2] = {0,0};
int counter = 2000;

//Sample data//
float data_red[500] = {
  1110  ,
1112  ,
1109  ,
1109  ,
1113  ,
1111  ,
1110  ,
1111  ,
1107  ,
1113  ,
1111  ,
1115  ,
1114  ,
1109  ,
1109  ,
1105  ,
1095  ,
1099  ,
1095  ,
1099  ,
1107  ,
1101  ,
1103  ,
1098  ,
1099  ,
1105  ,
1099  ,
1102  ,
1098  ,
1104  ,
1101  ,
1102  ,
1110  ,
1105  ,
1105  ,
1110  ,
1103  ,
1109  ,
1109  ,
1109  ,
1110  ,
1109  ,
1108  ,
1108  ,
1110  ,
1111  ,
1111  ,
1107  ,
1103  ,
1097  ,
1097  ,
1096  ,
1093  ,
1099  ,
1101  ,
1100  ,
1098  ,
1094  ,
1098  ,
1096  ,
1097  ,
1099  ,
1100  ,
1101  ,
1101  ,
1100  ,
1099  ,
1102  ,
1104  ,
1106  ,
1103  ,
1101  ,
1106  ,
1105  ,
1105  ,
1109  ,
1106  ,
1108  ,
1108  ,
1105  ,
1112  ,
1112  ,
1108  ,
1110  ,
1106  ,
1104  ,
1097  ,
1094  ,
1096  ,
1096  ,
1097  ,
1097  ,
1099  ,
1096  ,
1096  ,
1102  ,
1098  ,
1099  ,
1102  ,
1100  ,
1096  ,
1098  ,
1101  ,
1103  ,
1106  ,
1103  ,
1107  ,
1102  ,
1108  ,
1105  ,
1107  ,
1111  ,
1110  ,
1109  ,
1110  ,
1113  ,
1112  ,
1112  ,
1112  ,
1112  ,
1110  ,
1111  ,
1106  ,
1102  ,
1101  ,
1095  ,
1101  ,
1104  ,
1104  ,
1103  ,
1103  ,
1103  ,
1104  ,
1103  ,
1101  ,
1104  ,
1106  ,
1105  ,
1107  ,
1109  ,
1108  ,
1109  ,
1108  ,
1111  ,
1114  ,
1112  ,
1112  ,
1113  ,
1113  ,
1110  ,
1114  ,
1113  ,
1117  ,
1117  ,
1116  ,
1117  ,
1113  ,
1113  ,
1109  ,
1106  ,
1105  ,
1101  ,
1101  ,
1106  ,
1106  ,
1105  ,
1105  ,
1103  ,
1107  ,
1111  ,
1111  ,
1109  ,
1104  ,
1107  ,
1112  ,
1107  ,
1106  ,
1110  ,
1116  ,
1113  ,
1112  ,
1113  ,
1116  ,
1113  ,
1116  ,
1113  ,
1116  ,
1116  ,
1118  ,
1116  ,
1118  ,
1114  ,
1111  ,
1103  ,
1106  ,
1105  ,
1108  ,
1107  ,
1108  ,
1108  ,
1108  ,
1110  ,
1108  ,
1109  ,
1110  ,
1108  ,
1110  ,
1110  ,
1110  ,
1109  ,
1111  ,
1116  ,
1113  ,
1116  ,
1113  ,
1119  ,
1117  ,
1117  ,
1116  ,
1115  ,
1119  ,
1119  ,
1117  ,
1115  ,
1116  ,
1110  ,
1106  ,
1103  ,
1103  ,
1106  ,
1107  ,
1110  ,
1107  ,
1109  ,
1102  ,
1111  ,
1112  ,
1106  ,
1111  ,
1112  ,
1112  ,
1107  ,
1114  ,
1111  ,
1112  ,
1115  ,
1111  ,
1113  ,
1118  ,
1114  ,
1113  ,
1120  ,
1114  ,
1117  ,
1118  ,
1116  ,
1118  ,
1119  ,
1114  ,
1113  ,
1108  ,
1105  ,
1106  ,
1104  ,
1105  ,
1106  ,
1107  ,
1107  ,
1105  ,
1107  ,
1106  ,
1112  ,
1107  ,
1109  ,
1109  ,
1108  ,
1111  ,
1111  ,
1115  ,
1112  ,
1110  ,
1114  ,
1114  ,
1114  ,
1115  ,
1115  ,
1117  ,
1117  ,
1117  ,
1119  ,
1119  ,
1123  ,
1117  ,
1114  ,
1111  ,
1110  ,
1103  ,
1107  ,
1104  ,
1109  ,
1105  ,
1107  ,
1110  ,
1106  ,
1106  ,
1109  ,
1110  ,
1110  ,
1112  ,
1109  ,
1109  ,
1111  ,
1112  ,
1113  ,
1112  ,
1118  ,
1115  ,
1114  ,
1119  ,
1116  ,
1120  ,
1118  ,
1119  ,
1120  ,
1118  ,
1121  ,
1119  ,
1121  ,
1121  ,
1119  ,
1121  ,
1116  ,
1110  ,
1106  ,
1110  ,
1112  ,
1109  ,
1110  ,
1111  ,
1110  ,
1107  ,
1111  ,
1112  ,
1113  ,
1112  ,
1112  ,
1115  ,
1111  ,
1113  ,
1116  ,
1111  ,
1116  ,
1115  ,
1117  ,
1120  ,
1119  ,
1122  ,
1119  ,
1118  ,
1120  ,
1121  ,
1119  ,
1125  ,
1122  ,
1120  ,
1121  ,
1119  ,
1114  ,
1112  ,
1108  ,
1104  ,
1106  ,
1111  ,
1107  ,
1110  ,
1107  ,
1110  ,
1110  ,
1112  ,
1116  ,
1110  ,
1113  ,
1109  ,
1111  ,
1110  ,
1112  ,
1113  ,
1114  ,
1116  ,
1116  ,
1112  ,
1117  ,
1115  ,
1116  ,
1117  ,
1121  ,
1118  ,
1118  ,
1116  ,
1118  ,
1119  ,
1117  ,
1116  ,
1112  ,
1108  ,
1107  ,
1104  ,
1109  ,
1109  ,
1111  ,
1107  ,
1105  ,
1105  ,
1106  ,
1109  ,
1112  ,
1108  ,
1109  ,
1112  ,
1112  ,
1115  ,
1109  ,
1115  ,
1110  ,
1115  ,
1115  ,
1117  ,
1117  ,
1117  ,
1116  ,
1120  ,
1118  ,
1118  ,
1117  ,
1117  ,
1119  ,
1117  ,
1121  ,
1118  ,
1119  ,
1110  ,
1107  ,
1106  ,
1106  ,
1109  ,
1105  ,
1104  ,
1104  ,
1105  ,
1108  ,
1109  ,
1111  ,
1111  ,
1107  ,
1111  ,
1109  ,
1111  ,
1107  ,
1111  ,
1109  ,
1108  ,
1110  ,
1112  ,
1112  ,
1113  ,
1112  ,
1110  ,
1117  ,
1110  ,
1113  ,
1113  ,
1115  ,
1114  ,
1113  ,
1114  ,
1111  ,
1108  ,
1099  ,
1098  ,
1099  ,
1100  ,
1101  ,
1101  ,
1103  ,
1103  ,
1097  ,
1103  ,
1106  ,
1106  ,
1104  ,
1107  ,
1102  ,
1104  ,
1105  ,
1111  ,
1105  ,
1107  ,
1108  ,
1108  ,
1107  ,

};

float data_nir[500] = {
  1657  ,
1654  ,
1659  ,
1660  ,
1655  ,
1651  ,
1654  ,
1654  ,
1653  ,
1653  ,
1654  ,
1651  ,
1658  ,
1650  ,
1649  ,
1646  ,
1642  ,
1638  ,
1641  ,
1639  ,
1639  ,
1642  ,
1644  ,
1643  ,
1640  ,
1640  ,
1643  ,
1641  ,
1639  ,
1645  ,
1643  ,
1642  ,
1644  ,
1643  ,
1645  ,
1649  ,
1648  ,
1645  ,
1645  ,
1651  ,
1649  ,
1653  ,
1652  ,
1653  ,
1653  ,
1656  ,
1651  ,
1647  ,
1641  ,
1634  ,
1640  ,
1638  ,
1638  ,
1642  ,
1639  ,
1639  ,
1639  ,
1639  ,
1639  ,
1641  ,
1641  ,
1639  ,
1637  ,
1639  ,
1642  ,
1638  ,
1645  ,
1643  ,
1643  ,
1642  ,
1645  ,
1644  ,
1641  ,
1643  ,
1644  ,
1643  ,
1645  ,
1649  ,
1645  ,
1647  ,
1648  ,
1649  ,
1652  ,
1646  ,
1648  ,
1637  ,
1633  ,
1635  ,
1628  ,
1635  ,
1634  ,
1634  ,
1635  ,
1636  ,
1633  ,
1634  ,
1637  ,
1636  ,
1637  ,
1636  ,
1639  ,
1640  ,
1640  ,
1640  ,
1640  ,
1645  ,
1642  ,
1643  ,
1643  ,
1645  ,
1645  ,
1650  ,
1648  ,
1648  ,
1651  ,
1646  ,
1647  ,
1652  ,
1650  ,
1651  ,
1650  ,
1646  ,
1643  ,
1639  ,
1638  ,
1635  ,
1640  ,
1643  ,
1640  ,
1642  ,
1640  ,
1637  ,
1639  ,
1641  ,
1642  ,
1642  ,
1640  ,
1639  ,
1641  ,
1645  ,
1644  ,
1647  ,
1650  ,
1654  ,
1650  ,
1647  ,
1651  ,
1652  ,
1650  ,
1655  ,
1655  ,
1649  ,
1649  ,
1652  ,
1652  ,
1650  ,
1652  ,
1647  ,
1644  ,
1638  ,
1636  ,
1639  ,
1643  ,
1639  ,
1643  ,
1641  ,
1643  ,
1641  ,
1642  ,
1644  ,
1648  ,
1642  ,
1641  ,
1647  ,
1646  ,
1642  ,
1644  ,
1648  ,
1643  ,
1647  ,
1644  ,
1644  ,
1648  ,
1645  ,
1644  ,
1647  ,
1647  ,
1649  ,
1652  ,
1648  ,
1646  ,
1641  ,
1634  ,
1633  ,
1640  ,
1636  ,
1639  ,
1642  ,
1638  ,
1640  ,
1642  ,
1640  ,
1645  ,
1642  ,
1641  ,
1640  ,
1640  ,
1642  ,
1644  ,
1641  ,
1643  ,
1640  ,
1641  ,
1641  ,
1646  ,
1646  ,
1644  ,
1645  ,
1646  ,
1647  ,
1645  ,
1650  ,
1649  ,
1645  ,
1644  ,
1636  ,
1633  ,
1632  ,
1639  ,
1636  ,
1638  ,
1638  ,
1631  ,
1632  ,
1632  ,
1635  ,
1635  ,
1634  ,
1641  ,
1637  ,
1640  ,
1642  ,
1645  ,
1647  ,
1643  ,
1646  ,
1645  ,
1649  ,
1647  ,
1644  ,
1647  ,
1648  ,
1644  ,
1645  ,
1645  ,
1642  ,
1643  ,
1649  ,
1645  ,
1636  ,
1631  ,
1631  ,
1633  ,
1640  ,
1641  ,
1637  ,
1633  ,
1637  ,
1635  ,
1637  ,
1637  ,
1637  ,
1636  ,
1637  ,
1638  ,
1638  ,
1635  ,
1638  ,
1638  ,
1639  ,
1643  ,
1645  ,
1645  ,
1642  ,
1642  ,
1642  ,
1645  ,
1648  ,
1644  ,
1644  ,
1646  ,
1646  ,
1645  ,
1643  ,
1637  ,
1634  ,
1631  ,
1630  ,
1634  ,
1633  ,
1632  ,
1635  ,
1641  ,
1638  ,
1637  ,
1640  ,
1639  ,
1639  ,
1639  ,
1643  ,
1639  ,
1639  ,
1645  ,
1642  ,
1639  ,
1641  ,
1643  ,
1640  ,
1642  ,
1649  ,
1642  ,
1648  ,
1646  ,
1648  ,
1644  ,
1649  ,
1649  ,
1652  ,
1651  ,
1648  ,
1644  ,
1641  ,
1637  ,
1636  ,
1636  ,
1637  ,
1640  ,
1640  ,
1640  ,
1639  ,
1641  ,
1639  ,
1638  ,
1637  ,
1638  ,
1639  ,
1639  ,
1639  ,
1641  ,
1641  ,
1640  ,
1642  ,
1645  ,
1642  ,
1641  ,
1644  ,
1645  ,
1644  ,
1641  ,
1645  ,
1644  ,
1646  ,
1646  ,
1649  ,
1646  ,
1643  ,
1641  ,
1639  ,
1633  ,
1636  ,
1634  ,
1634  ,
1640  ,
1639  ,
1635  ,
1635  ,
1634  ,
1636  ,
1633  ,
1632  ,
1638  ,
1637  ,
1639  ,
1636  ,
1643  ,
1640  ,
1643  ,
1641  ,
1641  ,
1648  ,
1642  ,
1644  ,
1645  ,
1649  ,
1646  ,
1645  ,
1645  ,
1649  ,
1650  ,
1651  ,
1650  ,
1644  ,
1641  ,
1636  ,
1640  ,
1637  ,
1636  ,
1640  ,
1639  ,
1641  ,
1638  ,
1634  ,
1642  ,
1639  ,
1639  ,
1644  ,
1643  ,
1647  ,
1642  ,
1651  ,
1644  ,
1642  ,
1644  ,
1642  ,
1644  ,
1648  ,
1644  ,
1648  ,
1652  ,
1652  ,
1650  ,
1652  ,
1654  ,
1653  ,
1651  ,
1653  ,
1650  ,
1654  ,
1650  ,
1644  ,
1642  ,
1637  ,
1637  ,
1635  ,
1641  ,
1637  ,
1636  ,
1636  ,
1638  ,
1636  ,
1643  ,
1645  ,
1638  ,
1650  ,
1650  ,
1650  ,
1647  ,
1645  ,
1647  ,
1649  ,
1646  ,
1653  ,
1655  ,
1652  ,
1648  ,
1653  ,
1650  ,
1651  ,
1653  ,
1655  ,
1653  ,
1649  ,
1657  ,
1654  ,
1651  ,
1648  ,
1641  ,
1639  ,
1637  ,
1634  ,
1635  ,
1636  ,
1643  ,
1642  ,
1640  ,
1646  ,
1644  ,
1644  ,
1645  ,
1640  ,
1642  ,
1643  ,
1644  ,
1647  ,
1646  ,
1649  ,
1652  ,
1650  ,
1649  ,
1651  ,

};
